<?xml version="1.0" encoding="UTF-8"?>
<description:Group xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:description="http://www.eclipse.org/sirius/description/1.1.0" xmlns:description_1="http://www.eclipse.org/sirius/diagram/description/1.1.0" xmlns:style="http://www.eclipse.org/sirius/diagram/description/style/1.1.0" xmlns:tool="http://www.eclipse.org/sirius/diagram/description/tool/1.1.0" xmlns:tool_1="http://www.eclipse.org/sirius/description/tool/1.1.0" name="BackendDesign" version="12.0.0.2017041100">
  <ownedViewpoints name="BackendViewpoint" modelFileExtension="xmi">
    <ownedRepresentations xsi:type="description_1:DiagramDescription" name="Database Diagram" domainClass="ModelDrivenEngineering.BackendConfig" enablePopupBars="true">
      <defaultLayer name="Default">
        
        <!-- NODE: Table -->
        <nodeMappings name="TableNode" semanticCandidatesExpression="feature:database.tables" domainClass="ModelDrivenEngineering.Table">
          <style xsi:type="style:FlatContainerStyleDescription" labelExpression="feature:name" tooltipExpression="feature:name">
            <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
            <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
            <backgroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='light_blue']"/>
            <foregroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='white']"/>
          </style>
          
          <!-- SUB-NODE: Column -->
          <subNodeMappings name="ColumnList" semanticCandidatesExpression="feature:columns" domainClass="ModelDrivenEngineering.Column">
             <style xsi:type="style:SquareDescription" labelExpression="feature:name + ' : ' + feature:type" resizeKind="NSEW">
                <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
                <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
                <color xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='white']"/>
             </style>
          </subNodeMappings>
        </nodeMappings>

        <!-- EDGE: Relation -->
        <edgeMappings name="RelationEdge" sourceMapping="//@ownedViewpoints[name='BackendViewpoint']/@ownedRepresentations[name='Database Diagram']/@defaultLayer/@nodeMappings[name='TableNode']" targetMapping="//@ownedViewpoints[name='BackendViewpoint']/@ownedRepresentations[name='Database Diagram']/@defaultLayer/@nodeMappings[name='TableNode']" targetFinderExpression="feature:targetTable" domainClass="ModelDrivenEngineering.Relation">
          <style sizeComputationExpression="2">
            <strokeColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='gray']"/>
            <centerLabelStyleDescription labelExpression="feature:type"/>
            <endLabelStyleDescription labelExpression="feature:onDelete"/>
          </style>
        </edgeMappings>
      </defaultLayer>
      
      <!-- TOOLS PALETTE -->
      <toolSection name="Creation">
        
        <!-- Tool: Create Table -->
        <ownedTools xsi:type="tool:ContainerCreationDescription" name="CreateTable" label="Table" containerMappings="//@ownedViewpoints[name='BackendViewpoint']/@ownedRepresentations[name='Database Diagram']/@defaultLayer/@nodeMappings[name='TableNode']">
            <variable name="container"/>
            <viewVariable name="containerView"/>
            <initialOperation>
                <firstModelOperations xsi:type="tool_1:CreateInstance" typeName="ModelDrivenEngineering.Table" referenceName="tables">
                    <setValue featureName="name" valueExpression="NewTable"/>
                </firstModelOperations>
            </initialOperation>
        </ownedTools>

        <!-- Tool: Create Column -->
        <ownedTools xsi:type="tool:NodeCreationDescription" name="CreateColumn" label="Column" nodeMappings="//@ownedViewpoints[name='BackendViewpoint']/@ownedRepresentations[name='Database Diagram']/@defaultLayer/@nodeMappings[name='TableNode']/@subNodeMappings[name='ColumnList']">
            <variable name="container"/>
            <viewVariable name="containerView"/>
            <initialOperation>
                <firstModelOperations xsi:type="tool_1:CreateInstance" typeName="ModelDrivenEngineering.Column" referenceName="columns">
                    <setValue featureName="name" valueExpression="new_column"/>
                    <setValue featureName="type" valueExpression="STRING"/>
                </firstModelOperations>
            </initialOperation>
        </ownedTools>
        
        <!-- Tool: Create Relation -->
         <ownedTools xsi:type="tool:EdgeCreationDescription" name="CreateRelation" label="Relation" edgeMappings="//@ownedViewpoints[name='BackendViewpoint']/@ownedRepresentations[name='Database Diagram']/@defaultLayer/@edgeMappings[name='RelationEdge']">
            <sourceVariable name="source"/>
            <targetVariable name="target"/>
            <sourceViewVariable name="sourceView"/>
            <targetViewVariable name="targetView"/>
            <initialOperation>
                <!-- Complex operation: Find the owning column, create relation on it -->
                <!-- Simplified for POC: Creating global relation or assuming context -->
                <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:source">
                    <subModelOperations xsi:type="tool_1:CreateInstance" typeName="ModelDrivenEngineering.Relation" referenceName="relation">
                         <setValue featureName="targetTable" valueExpression="var:target"/>
                    </subModelOperations>
                </firstModelOperations>
            </initialOperation>
        </ownedTools>
        
      </toolSection>
    </ownedRepresentations>
  </ownedViewpoints>
</description:Group>
